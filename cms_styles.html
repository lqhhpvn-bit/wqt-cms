<style>
  /* ================== TOKENS / RESET ================== */
  :root{
    --bg:        #F6F7FB;
    --surface:   #ffffff;
    --text:      #111827;
    --muted:     #6B7280;
    --pri:       #4F46E5;
    --pri-600:   #4338CA;
    --border:    #E5E7EB;
    --ok:        #16a34a;
    --warn:      #f59e0b;
    --danger:    #ef4444;
    --sidebar:   #ffffff;
    --shadow:    0 6px 20px rgba(17, 24, 39, .06);
    --radius:    14px;
    --radius-sm: 10px;
    --radius-lg: 18px;
  }
  *{ box-sizing:border-box; }
  html,body{ height:100%; }
  body{
    margin:0;
    padding-top:56px;
    background:var(--bg);
    color:var(--text);
    font:14px/1.55 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Inter, Roboto, Arial;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }
  img{ max-width:100%; }
  .hidden{ display:none !important; }
  .hideable{ display:none; }
  .muted{ color:var(--muted); }
  .num{ text-align:right; }
  .m8{ margin-top:8px; }
  .m12{ margin-top:12px; }
  .m16{ margin-top:16px; }
  .m24{ margin-top:24px; }
  .spacer{ flex:1; }

  /* ================== LAYOUT (TOPBAR + SIDEBAR + MAIN) ================== */
  .topbar{
    position:fixed; top:0; left:0; right:0; z-index:120;
    display:flex; align-items:center; gap:12px;
    height:56px; padding:0 16px;
    background:var(--surface);
    border-bottom:1px solid var(--border);
    box-shadow:0 8px 24px rgba(15,23,42,0.06);
  }
  .brand{ font-weight:700; letter-spacing:.2px; }
  .auth-status{
    font-size:13px;
    background:rgba(79,70,229,0.08);
    border:1px solid rgba(79,70,229,0.25);
    color:var(--pri);
    padding:6px 10px;
    border-radius:999px;
    margin-right:12px;
  }

  .app{
    display:grid;
    grid-template-columns: 240px minmax(0, 1fr);
    gap:16px;
    padding:0 16px 32px;
    width:100%;
    align-items:flex-start;
  }

  .app > aside.sidebar{
    grid-column:1;
    grid-row:1;
  }

  .app > main.content{
    grid-column:2;
    grid-row:1;
  }

  .content{
    display:flex;
    flex-direction:column;
    gap:16px;
    align-items:stretch;
    padding-bottom:32px;
    width:100%;
    min-width:0;
  }

  .login-blocker{
    position:fixed;
    inset:0;
    background:#ffffff;
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:200;
    padding:24px;
  }
  #login_blocker{
    grid-column:1 / -1;
    grid-row:1;
  }
  body.needs-login .app > :not(#login_blocker){ pointer-events:none; }
  .login-blocker.hidden{ display:none !important; }
  .login-blocker-card{
    max-width:420px;
    width:100%;
    padding:24px;
    background:#fff;
    border-radius:var(--radius);
    box-shadow:0 20px 45px rgba(15,23,42,0.18);
    display:flex;
    flex-direction:column;
    gap:18px;
    text-align:left;
  }
  .login-blocker-title{
    font-size:18px;
    font-weight:700;
    color:var(--pri);
    margin-bottom:4px;
  }
  .login-form{ display:flex; flex-direction:column; gap:12px; }
  .login-field label{
    display:block;
    font-size:12px;
    font-weight:600;
    color:var(--muted);
    margin-bottom:6px;
  }
  .login-actions{
    display:flex;
    justify-content:flex-end;
    gap:10px;
    flex-wrap:wrap;
  }
  .login-actions .btn{ min-width:140px; }

  /* Sidebar (menu dá»c) */
  #menu{
    padding:12px;
    background:var(--sidebar);
    border:1px solid var(--border);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    display:flex;
    flex-direction:column;
    gap:6px;
    position:sticky;
    top:56px;
    max-height:calc(100vh - 72px);
    overflow:auto;
  }
  .tabbtn{
    display:flex; align-items:center; gap:10px;
    width:100%;
    padding:10px 12px;
    background:#fff;
    border:1px solid var(--border);
    border-radius:12px;
    color:#111827;
    cursor:pointer;
    transition:background .2s ease, transform .2s ease, box-shadow .2s ease, border-color .2s ease, color .2s ease;
    text-align:left;
  }
  .tabbtn:hover{
    background:rgba(79,70,229,0.12);
    border-color:rgba(79,70,229,0.35);
    box-shadow:0 10px 24px rgba(79,70,229,0.15);
    transform:translateY(-2px) scale(1.01);
  }
  .tabbtn.active{
    background:rgba(79,70,229,.18);
    border-color:rgba(79,70,229,.55);
    box-shadow:0 12px 28px rgba(79,70,229,0.22);
    color:var(--pri);
    font-weight:600;
  }
  .tabbtn .ico{ font-size:16px; opacity:.9; }

  /* Main content */
  .main{
    min-width:0;
  }
  .view{
    display:none;
    padding:16px;
    background:var(--surface);
    border:1px solid var(--border);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    width:100%;
    max-width:none;
    min-width:0;
    flex-direction:column;
    gap:16px;
  }
  .view.view-active{
    display:flex;
  }
  h2{
    margin:0 0 12px 0;
    font-size:18px; line-height:1.2;
  }
  .sub-title{
    font-weight:600; margin-bottom:8px;
  }

  /* ================== KPI ================== */
  .kpi-grid4{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(260px, 1fr));
    gap:16px;
    margin-bottom:16px;
  }
  .kpi-panel{
    background:#fff;
    border:1px solid var(--border);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:16px;
    display:flex;
    flex-direction:column;
    gap:14px;
  }
  .kpi-panel-title{
    font-weight:700;
    font-size:14px;
    color:#1f2937;
    letter-spacing:.3px;
  }
  .kpi-panel-body{
    display:grid;
    gap:12px;
    grid-template-columns:repeat(auto-fit, minmax(160px,1fr));
  }
  .kpi{
    background:linear-gradient(135deg, rgba(79,70,229,.08), rgba(79,70,229,0));
    border:1px solid rgba(79,70,229,0.18);
    border-radius:var(--radius-sm);
    padding:14px 16px;
    transition:transform .2s ease, box-shadow .2s ease;
  }
  .kpi:hover{
    transform:translateY(-2px);
    box-shadow:0 12px 28px rgba(79,70,229,0.18);
  }
  .kpi-title{
    font-size:12px; letter-spacing:.3px; color:var(--muted);
  }
  .kpi-value{
    margin-top:8px;
    font-size:22px; font-weight:800;
    word-break:break-word;
    overflow-wrap:anywhere;
  }
  .kpi-value.single-line{
    display:block;
    overflow:hidden;
    text-overflow:ellipsis;
    white-space:nowrap;
    font-size:20px;
  }
  .kpi-note{ margin-top:6px; font-size:12px; color:var(--muted); }

  /* ================== CARDS / GRID ================== */
  .card{
    background:#fff;
    border:1px solid var(--border);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:16px;
  }
  .card-foot{
    margin-top:16px;
    display:flex;
    gap:8px;
    align-items:center;
  }
  .card-head{
    font-weight:700;
    font-size:14px;
    color:#1f2937;
  }
  .card-head + .card-body{
    margin-top:12px;
  }
  .card-title{
    font-weight:700; margin-bottom:8px;
  }
  .feature-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(220px, 1fr));
    gap:16px;
    margin-top:16px;
    align-items:stretch;
  }
  .feature{
    padding:16px;
    border:1px solid var(--border);
    border-radius:var(--radius-sm);
    background:linear-gradient(135deg, rgba(79,70,229,0.08), rgba(255,255,255,0));
    box-shadow:0 10px 24px rgba(79,70,229,0.08);
    display:flex;
    flex-direction:column;
    gap:8px;
    height:100%;
  }
  .feature-title{
    font-weight:700;
    color:#1f2937;
    letter-spacing:.2px;
  }
  .alert{
    margin-top:12px;
    padding:12px 14px;
    border-radius:12px;
    border:1px solid var(--border);
    background:#fff7ed;
    color:#9a3412;
  }
  .alert.info{
    background:#eef2ff;
    color:#3730a3;
    border-color:#c7d2fe;
  }
  .chip{
    display:inline-flex;
    align-items:center;
    padding:4px 10px;
    border-radius:999px;
    font-size:12px;
    font-weight:600;
    background:#e0f2fe;
    color:#0369a1;
  }
  .chip.pulse{
    animation:pulseGlow 2.8s ease-in-out infinite;
    box-shadow:0 0 0 rgba(34,197,94,0.4);
  }
  .chip.green{ background:#dcfce7; color:#166534; }
  @keyframes pulseGlow{
    0%{ box-shadow:0 0 0 0 rgba(34,197,94,0.36); }
    70%{ box-shadow:0 0 0 10px rgba(34,197,94,0); }
    100%{ box-shadow:0 0 0 0 rgba(34,197,94,0); }
  }
  .dash-week{
    margin-top:24px;
    display:flex;
    flex-direction:column;
    gap:12px;
  }
  .dash-week-head{
    display:flex;
    align-items:center;
    justify-content:space-between;
    flex-wrap:wrap;
    gap:12px;
  }
  .dash-week-label{
    font-weight:700;
    font-size:16px;
    color:#1f2937;
  }
  .dash-week-filter{
    display:flex;
    align-items:center;
    gap:8px;
  }
  .dash-week-filter label{
    font-size:13px;
    color:var(--muted);
  }
  .dash-week-filter select{
    min-width:128px;
  }
  .dash-week-grid{
    display:grid;
    grid-template-columns:repeat(2, minmax(0, 1fr));
    gap:16px;
    margin-top:16px;
  }
  .dash-week-grid .card{
    display:flex;
    flex-direction:column;
  }
  .dash-week-grid .card-body{
    flex:1;
    display:flex;
    flex-direction:column;
  }
  .dash-week-grid .card-body .tbl{
    flex:1;
  }
  .two-col{
    display:grid; grid-template-columns:1fr 1fr; gap:16px;
  }

  /* ================== TABLE ================== */
  .tbl{
    width:100%;
    border-collapse:separate;
    border-spacing:0;
    border:1px solid var(--border);
    border-radius:12px;
    overflow:hidden;
    background:#fff;
  }
  .tbl th, .tbl td{
    padding:10px 12px;
    border-bottom:1px solid var(--border);
    white-space:nowrap;
    text-overflow:ellipsis;
    overflow:hidden;
    font-size:13px;
  }
  .tbl thead th{
    background:#fafafa;
    font-weight:600;
    color:#334155;
  }
  .tbl tbody tr:hover{ background:#fafafa; }
  .tbl tbody tr:last-child td{ border-bottom:none; }
  .tbl .muted{ color:var(--muted); }
  .tbl .status-ok{ color:var(--ok); font-weight:600; }
  .tbl .status-warn{ color:var(--warn); font-weight:600; }
  .tbl .status-danger{ color:var(--danger); font-weight:700; }
  .table-card{ padding:0; display:flex; flex-direction:column; overflow:hidden; }
  .table-card-head{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 16px; border-bottom:1px solid var(--border); flex-wrap:wrap; }
  .table-card-head .table-meta{ margin-left:auto; }
  .table-meta{ font-size:13px; }
  .table-scroll{ width:100%; overflow-x:auto; }
  .tbl-loans{ table-layout:fixed; min-width:1100px; }
  .tbl-loans th, .tbl-loans td{ vertical-align:middle; }
  .tbl-loans .col-code{ width:120px; }
  .tbl-loans .col-cus-id{ width:120px; }
  .tbl-loans .col-name{ min-width:200px; max-width:260px; }
  .tbl-loans .col-seg{ max-width:140px; }
  .tbl-loans .col-type{ max-width:160px; }
  .tbl-loans .col-date{ width:140px; }
  .tbl-loans .col-small{ width:96px; }
  .tbl-loans .col-amount{ width:140px; }
  .tbl-loans .col-status{ max-width:140px; }
  .tbl-loans .col-editor{ max-width:220px; white-space:normal; overflow-wrap:anywhere; }
  .tbl-loans .col-actions{ width:180px; }
  .action-group{ display:inline-flex; gap:6px; flex-wrap:nowrap; }
  .action-group .btn{ flex:1 0 auto; white-space:nowrap; }
  @media (max-width: 1280px){
    .tbl-loans th.optional,
    .tbl-loans td.optional{ display:none; }
  }

  /* ================== BUTTONS ================== */
  .btn{
    display:inline-flex; align-items:center; gap:8px;
    height:34px; padding:0 12px;
    border:1px solid var(--border);
    background:#fff;
    color:#111827;
    border-radius:10px;
    cursor:pointer;
    transition:.15s ease;
  }
  .btn.ghost{
    background:#fff;
    border-color:var(--border);
    color:#111827;
  }
  .btn.ghost:hover{ background:#f8fafc; }
  .btn:hover{ transform:translateY(-1px); }
  .btn.primary{ background:var(--pri); border-color:var(--pri); color:#fff; }
  .btn.primary:hover{ background:var(--pri-600); }
  .btn.danger{ background:#fff0f0; color:#b91c1c; border-color:#fecaca; }
  .btn:disabled{ opacity:.6; cursor:not-allowed; transform:none; }
  .btn .ico{ font-size:16px; }

  .align-right{ display:flex; gap:8px; justify-content:flex-end; }
  .toolbar{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .toolbar > *{ flex:0 1 auto; }
  .toolbar .input{ width:auto; min-width:160px; flex:0 1 220px; }
  .toolbar .btn{ height:36px; }

  /* ================== FORMS ================== */
  .field{ display:flex; flex-direction:column; gap:6px; }
  .row{ display:grid; grid-template-columns:repeat(12,1fr); gap:12px; }
  .row.wrap{ display:flex; flex-wrap:wrap; gap:12px; }
  .checkbox-inline{ display:flex; align-items:center; gap:8px; font-size:13px; color:#374151; }
  .checkbox-inline input{ width:auto; height:auto; margin:0; }
  .col-2{ grid-column:span 2; }
  .col-3{ grid-column:span 3; }
  .col-4{ grid-column:span 4; }
  .col-6{ grid-column:span 6; }
  .col-8{ grid-column:span 8; }
  .col-12{ grid-column:span 12; }
  label{ font-size:12px; color:var(--muted); }
  input[type="text"], input[type="number"], input[type="date"], select, textarea{
    height:36px; padding:0 10px; width:100%;
    border:1px solid var(--border); border-radius:10px; background:#fff;
    outline:none;
  }
  textarea{ height:auto; padding:10px; min-height:96px; resize:vertical; }
  input:focus, select:focus, textarea:focus{
    border-color:#c7cbe0; box-shadow:0 0 0 3px rgba(79,70,229,.12);
  }

  /* ================== LOAN MANAGER ================== */
  .loanmgr-layout{
    display:grid;
    grid-template-columns:minmax(360px, 420px) minmax(0,1fr);
    gap:24px;
    align-items:flex-start;
  }
  .loanmgr-left,
  .loanmgr-right{ display:flex; flex-direction:column; gap:16px; }
  .loanmgr-slip{
    padding:0;
    overflow:hidden;
  }
  .loanmgr-slip .card-head{
    padding:16px 20px;
    border-bottom:1px solid var(--border);
  }
  .loanmgr-slip .card-body{
    padding:20px;
    display:flex;
    flex-direction:column;
    gap:20px;
  }
  .slip-filters{ display:grid; gap:12px; }
  .slip-filters--primary{ grid-template-columns:minmax(0,1fr) minmax(200px,240px) minmax(170px,auto); }
  .slip-filters--range{ grid-template-columns:minmax(0,1fr) minmax(0,1fr) minmax(170px,auto); }
  @media (max-width: 900px){
    .loanmgr-layout{ grid-template-columns:1fr; }
    .slip-filters--primary,
    .slip-filters--range{ grid-template-columns:repeat(auto-fit, minmax(160px,1fr)); }
  }
  .slip-field label{
    display:block;
    font-size:12px;
    font-weight:600;
    color:var(--muted);
    margin-bottom:6px;
  }
  .slip-actions{ display:flex; justify-content:flex-end; align-items:stretch; }
  .slip-actions .btn{ width:100%; min-height:36px; }
  .slip-summary{
    border:1px solid var(--border);
    border-radius:var(--radius);
    background:#f8fafc;
    padding:20px;
    display:flex;
    flex-direction:column;
    gap:20px;
    box-shadow:0 12px 28px rgba(15,23,42,0.09);
  }
  .slip-summary-head{ display:flex; justify-content:space-between; align-items:center; gap:12px; }
  .slip-summary-title{ font-weight:700; font-size:18px; }
  .slip-summary-meta{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));
    gap:12px;
    font-size:13px;
  }
  .slip-summary-meta .meta-label{ color:var(--muted); font-weight:600; margin-right:4px; display:inline-block; min-width:72px; }
  .slip-summary-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(180px,1fr));
    gap:16px;
  }
  .slip-summary-item{ padding:16px; border-radius:var(--radius-sm); background:#fff; border:1px solid rgba(79,70,229,.12); box-shadow:0 6px 14px rgba(79,70,229,0.08); }
  .slip-summary-item .title{ font-size:13px; font-weight:600; color:#1f2937; letter-spacing:.2px; }
  .slip-summary-item .value{ font-size:22px; font-weight:700; text-align:right; margin-top:6px; color:#1f2937; }
  .slip-summary-footer{
    background:#eef2ff;
    border-radius:var(--radius-sm);
    padding:12px 16px;
    font-weight:600;
    color:#312e81;
  }
  .tbl td.empty-cell{
    text-align:center;
    color:var(--muted);
    font-style:italic;
  }

  /* ================== KPI CONFIG ================== */
  .kpi-config-wrap{ margin-top:16px; }
  .kpi-config-list{ display:flex; flex-direction:column; gap:8px; margin-top:8px; }
  .kpi-config-item{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:10px 12px; border:1px solid var(--border); border-radius:var(--radius-sm); background:#fff; }
  .kpi-config-item label{ display:flex; align-items:center; gap:8px; font-weight:600; color:#1f2937; }
  .kpi-config-item input[type="checkbox"]{ width:auto; height:auto; }
  .kpi-config-actions{ display:flex; gap:6px; }
  .kpi-config-actions button{
    width:32px; height:32px;
    border-radius:8px;
    border:1px solid var(--border);
    background:#f3f4f6;
    cursor:pointer;
    font-size:14px;
    line-height:1;
  }
  .kpi-config-actions button:hover{ background:#e5e7eb; }

  /* ================== MODAL ================== */
  dialog.modal,
  .modal-overlay{
    position:fixed; inset:0; z-index:200;
    display:none; align-items:center; justify-content:center;
    padding:16px;
    border:none;
    background:transparent;
  }
  dialog.modal[open],
  .modal-overlay.show{ display:flex; }
  dialog.modal::backdrop{
    background:rgba(17,24,39,.35);
  }
  .modal-overlay::before{
    content:"";
    position:absolute; inset:0;
    background:rgba(17,24,39,.35);
  }
  dialog.modal .box,
  .modal-overlay .box{
    position:relative;
    width:min(720px, 96vw);
    background:#fff;
    border-radius:16px;
    box-shadow:var(--shadow);
    border:1px solid var(--border);
    padding:16px;
  }
  .modal .body{ display:flex; flex-direction:column; gap:12px; }
  .modal .body .row{ display:grid; grid-template-columns:repeat(12,1fr); gap:12px; }
  .modal .body .field{ display:flex; flex-direction:column; gap:6px; }
  .modal .head{ display:flex; align-items:center; gap:12px; }
  .modal .title{ font-weight:700; font-size:16px; }
  .modal .foot{ display:flex; gap:8px; justify-content:flex-end; margin-top:12px; }

  /* ================== TOAST / LOADING ================== */
  .toast{
    position:fixed; right:16px; bottom:16px; z-index:300;
    background:#111827; color:#fff;
    padding:10px 12px; border-radius:10px; box-shadow:var(--shadow);
    max-width:60ch;
  }
  .loading{
    position:fixed; inset:auto 16px 16px auto; z-index:280;
    background:#fff; border:1px solid var(--border); box-shadow:var(--shadow);
    padding:8px 12px; border-radius:10px; color:#374151;
    display:none;
  }
  .loading.show{ display:block; }

  /* ================== CRM ================== */
  .crm-columns{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(320px, 1fr));
    gap:16px;
  }
  .crm-col{ display:flex; flex-direction:column; gap:16px; }
  .tg-columns{ align-items:start; }
  .tg-stack{ display:flex; flex-direction:column; gap:16px; }

  /* ================== RESPONSIVE ================== */
  @media (max-width: 1024px){
    .loanmgr-layout{ grid-template-columns:1fr; }
    .slip-summary{ order:2; }
  }
  @media (max-width: 1100px){
    .app{ grid-template-columns: 200px 1fr; }
    .kpi-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); }
    .kpi-columns{ flex-direction:column; }
    .two-col{ grid-template-columns:1fr; }
  }
  @media (max-width: 720px){
    .app{ grid-template-columns: 1fr; }
    #menu{ position:relative; top:auto; max-height:none; }
    .dash-week-grid{ grid-template-columns:1fr; }
  }

  /* ================== ACCESSIBILITY ================== */
  .tabbtn:focus, .btn:focus{
    outline:2px solid rgba(79,70,229,.35);
    outline-offset:2px;
  }
</style>
